<!DOCTYPE html>

<html>

	<head>
  		<meta charset="utf-8">
  		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  		<!-- Importar nuestro ABI en el proyecto -->

      <script src="./../Plataforma Tokens/App/node_modules/@waves/waves-api/dist/waves-api.min.js"></script>
      <script>

        const Waves = WavesAPI.create(WavesAPI.MAINNET_CONFIG);
        
        console.log(Waves);

      </script>
  		
      <style>

  		</style>

  		<title> Plataforma Tokens </title>

	</head>

	<body style="background-color: lightgrey; text-align:center">


      <h1 style=""> Plataforma de Tokens - LOGIN</h1> 

      Introduce tu seed: <input id="seed"></input>

      <button onclick="login()"> Acceder </button>

      <br><br>     
      Informacion de cuenta <p id="info"> </p>

      <hr>

      <button onclick="envio()"> PAGAR </button>

		  <!-- Se ponen aqui los js y asi reduce el tiempo de carga del HTML -->
  		<script>

        var account = null;

        function login(){

          account = Waves.Seed.fromExistingPhrase(document.getElementById("seed").value);
          console.log(account);

          var info = document.getElementById("info");
          info.innerHTML = account.address +"<br>";
          

          Waves.API.Node.addresses.balance(account.address)
            .then((PromiseValue) => {
            console.log(PromiseValue.balance);
            info.innerHTML += "<br><b> Waves: </b>"+PromiseValue.balance+"<br>";
          });

         Waves.API.Node.assets.balance(account.address,"AFUG6HXViGfAnobd41H1sAeASUEmjF7dHsgt5K1XFcfM").then((value) => {
            console.log(value);
            info.innerHTML += "<br><b> TEFTOK: </b>"+value.balance/1000+"<br>";
          });


          Waves.API.Node.transactions.getList(account.address,100).then((txs) => {
            console.log(txs);
            info.innerHTML += "<br>TRANSACCIONES <br>";
            for(i=0; i<9; i++){
              info.innerHTML += ""+txs[i].id+"<br>";
            }
            
          });

        }

        function envio(){
            
            const transferData = {
            // An arbitrary address; mine, in this example
            recipient: '3P6onwAhnS1e63sFjN2PCKuRsxdHJuF6Qna',
            // ID of a token, or WAVES
            assetId: 'AFUG6HXViGfAnobd41H1sAeASUEmjF7dHsgt5K1XFcfM', //TEFTOK
            // The real amount is the given number divided by 10^(precision of the token)
            amount: 1000,
            // The same rules for these two fields
            feeAssetId: 'WAVES',
            fee: 100000,
            // 140 bytes of data (it's allowed to use Uint8Array here)
            attachment: '',
            timestamp: Date.now()
          };

          Waves.API.Node.transactions.broadcast('transfer', transferData, account.keyPair).then((responseData) => {
            console.log(responseData);
          });


        }



  		</script>
  		<!-- Incluir jquery y bootstrap -->
  		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  
	</body>
</html>